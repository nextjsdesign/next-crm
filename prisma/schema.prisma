generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

//
// ==========================
//        ENUMS
// ==========================
//

enum Role {
  admin
  technician
  receptionist
}

//
// ==========================
//        MODELS
// ==========================
//

model User {
  id        String    @id @default(uuid())
  name      String
  email     String    @unique
  password  String
  role      Role      @default(technician)
  workHours String?
  target    Int?
  bonus     Int?
  createdAt DateTime  @default(now())
  updatedAt DateTime? @updatedAt
  isActive  Boolean   @default(true)

  devices       Device[]
  repairs       Repair[]       @relation("RepairAssignedTech") // Asigned repairs
  notes         RepairNote[]
  notifications Notification[]
}

model Client {
  id        String   @id @default(uuid())
  name      String
  phone     String?
  email     String?
  address   String?
  createdAt DateTime @default(now())

  devices Device[]
}

model Device {
  id String @id @default(uuid())

  clientId String
  client   Client @relation(fields: [clientId], references: [id])

  userId String?
  user   User?   @relation(fields: [userId], references: [id])

  parentDeviceId String?

  sheetType String?
  status    String  @default("Primire")

  deviceType   String?
  brand        String?
  model        String?
  serialNumber String?

  problem     String?
  description String?
  accessories String?
  technician  String?

  priceEstimate  Float?
  advance        Float?
  warranty       String?
  priceConfirmed Boolean @default(false)

  liquidContact Boolean   @default(false)
  notes         String?
  deliveryDays  Int?
  deliveryDate  DateTime?

  receptionCondition String?
  receptionNotes     String?

  createdAt DateTime @default(now())

  repairs Repair[]
}

model Repair {
  id String @id @default(uuid())

  deviceId String
  device   Device @relation(fields: [deviceId], references: [id])

  assignedTechnicianId String?
  assignedTechnician   User? @relation("RepairAssignedTech", fields: [assignedTechnicianId], references: [id])

  takenAt    DateTime?
  status     String    @default("ÃŽn lucru")
  diagnostic String?
  notes      String?

  items        RepairItem[]
  historyNotes RepairNote[]

  createdAt DateTime  @default(now())
  updatedAt DateTime? @updatedAt
}

model RepairItem {
  id String @id @default(uuid())

  repairId String
  repair   Repair @relation(fields: [repairId], references: [id])

  kind      String
  label     String
  qty       Int    @default(1)
  unitPrice Float  @default(0)
}

model RepairNote {
  id       String   @id @default(uuid())
  repairId String
  repair   Repair   @relation(fields: [repairId], references: [id])

  userId String
  user   User   @relation(fields: [userId], references: [id])

  message   String
  createdAt DateTime @default(now())
}

model Notification {
  id String @id @default(uuid())

  userId String
  user   User   @relation(fields: [userId], references: [id])

  type     String
  message  String
  deviceId String?
  repairId String?

  read      Boolean  @default(false)
  createdAt DateTime @default(now())
}

//
// ==========================
//      SETTINGS !!!
// ==========================
//

model Settings {
  id          String   @id @default(uuid())
  companyName String
  email       String
  phone       String
  theme       String   @default("system")
  logoUrl     String?
  tabStyle    String   @default("classic")
  updatedAt   DateTime @updatedAt
}